{% extends 'main.html' %}

{% block title %}Chat Rooms{% endblock %}

{% block container %}
    {% include 'components/navbar.html' %}
    <div class='row text-center'>
        <div class='col'>
            <h1>Welcome to Chipper</h1>
        </div>
    </div>


    <div class='row' id='chirps'>
        Loading...
    </div>

    <script>
        const tweetsElement = document.getElementById("chirps")

        const xhr = new XMLHttpRequest()
        const method = 'GET' // "POST"
        const url = "/chipper/chirps"
        const responseType = "json"

        function handleDidLike(tweet_id, currentCount) {
            console.log(tweet_id, currentCount)
            return 0
        }

        function LikeBtn(tweet) {
            return "<button class='btn btn-primary btn-sm' onclick=handleDidLike(" +
                tweet.id + "," + tweet.likes + ")>" + tweet.likes + " Likes</button>"
        }

        function formatTweetElement(tweet) {
            return "<div class='col-12 col-md-10 mx-auto border rounded py-3 mb-4 tweet' id='tweet-" + tweet.id
                + "'><p>" + tweet.content +
                "</p><div class='btn-group'>" + LikeBtn(tweet) +
                "</div></div>"
        }

        xhr.responseType = responseType
        xhr.open(method, url)
        xhr.onload = function () {
            const serverResponse = xhr.response
            const listedItems = serverResponse.response // array
            var finalTweetStr = ""
            var i;
            for (i = 0; i < listedItems.length; i++) {
                var tweetObj = listedItems[i]
                var currentItem = formatTweetElement(tweetObj)
                finalTweetStr += currentItem
            }
            tweetsElement.innerHTML = finalTweetStr
        }
        xhr.send()
    </script>
{% endblock %}

{% block javascript %}
{% endblock %}
